<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neurax - IA Vocale & Design Web</title>
    
    <!-- SDK Vapi pour rÃ©ceptionniste IA -->
    <script src="https://cdn.jsdelivr.net/npm/@vapi-ai/web@2.3.3/dist/index.umd.js"></script>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2DLP22Q90B"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-2DLP22Q90B');
    </script>
</head>
<body>
    <div id="root"></div>
    <script type="module" src="/main.tsx"></script>

    <!-- Modal Vapi RÃ©ceptionniste -->
    <div id="vapi-demo-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #1a1a1a, #2d2d2d); padding: 40px; border-radius: 20px; max-width: 450px; text-align: center; border: 2px solid #00D4FF; box-shadow: 0 0 40px rgba(0, 212, 255, 0.3);">
            <h2 style="background: linear-gradient(135deg, #00D4FF, #7B61FF); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 15px; font-size: 28px; font-weight: bold;">ðŸ¤– RÃ©ceptionniste IA Neurax</h2>
            <p style="color: #ccc; margin-bottom: 30px; font-size: 16px;">Cliquez sur le bouton pour parler avec notre assistant intelligent</p>
            
            <button id="vapi-call-btn" style="background: linear-gradient(135deg, #00D4FF, #7B61FF); color: white; border: none; padding: 18px 40px; border-radius: 30px; font-size: 18px; font-weight: bold; cursor: pointer; margin-bottom: 20px; transition: all 0.3s; box-shadow: 0 5px 20px rgba(0, 212, 255, 0.4);">
                ðŸ“ž Appeler maintenant
            </button>
            
            <br>
            
            <button id="vapi-close-modal" style="background: rgba(255,255,255,0.1); color: #ccc; border: 1px solid #555; padding: 12px 25px; border-radius: 20px; cursor: pointer; transition: all 0.3s;">
                Fermer
            </button>
            
            <div id="vapi-status" style="margin-top: 25px; color: #00D4FF; font-size: 14px; min-height: 20px;"></div>
        </div>
    </div>

    <script>
        let vapiInstance = null;
        let isCallActive = false;

        // Fonction pour ouvrir le modal (appelÃ©e par le bouton du site)
        function neuraxOpenVapiDemo() {
            document.getElementById('vapi-demo-modal').style.display = 'flex';
        }

        // Fermer le modal
        document.getElementById('vapi-close-modal').addEventListener('click', () => {
            document.getElementById('vapi-demo-modal').style.display = 'none';
            if (vapiInstance && isCallActive) {
                vapiInstance.stop();
                isCallActive = false;
            }
        });

        // Gestion de l'appel
        document.getElementById('vapi-call-btn').addEventListener('click', async () => {
            const btn = document.getElementById('vapi-call-btn');
            const status = document.getElementById('vapi-status');

            if (!isCallActive) {
                try {
                    // VÃ©rification du SDK
                    if (!window.Vapi) {
                        status.textContent = 'âŒ Erreur: SDK Vapi non chargÃ©';
                        status.style.color = '#ff4444';
                        return;
                    }

                    status.textContent = 'ðŸ”„ Connexion en cours...';
                    status.style.color = '#00D4FF';

                    // Initialisation avec ta clÃ© publique
                    vapiInstance = new window.Vapi('70c92dbd-2937-4da0-8884-edc63dc82a2e');
                    
                    // DÃ©marrage de l'appel avec ton assistant
                    await vapiInstance.start({
                        assistantId: 'bde29016-68ab-4ec6-9d81-147af8678af4'
                    });

                    isCallActive = true;
                    btn.textContent = 'ðŸ”´ Raccrocher';
                    btn.style.background = 'linear-gradient(135deg, #ff4444, #cc0000)';
                    status.textContent = 'âœ… Appel en cours... Parlez maintenant !';
                    status.style.color = '#00ff88';

                    // Track dans Google Analytics
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'vapi_call_started', {
                            event_category: 'engagement',
                            event_label: 'RÃ©ceptionniste IA'
                        });
                    }

                } catch (error) {
                    console.error('Erreur Vapi:', error);
                    status.textContent = 'âŒ Erreur: ' + error.message;
                    status.style.color = '#ff4444';
                    isCallActive = false;
                }
            } else {
                // Raccrocher
                if (vapiInstance) {
                    vapiInstance.stop();
                }
                isCallActive = false;
                btn.textContent = 'ðŸ“ž Appeler maintenant';
                btn.style.background = 'linear-gradient(135deg, #00D4FF, #7B61FF)';
                status.textContent = 'ðŸ“ž Appel terminÃ©';
                status.style.color = '#ccc';

                // Track dans Google Analytics
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'vapi_call_ended', {
                        event_category: 'engagement',
                        event_label: 'RÃ©ceptionniste IA'
                    });
                }
            }
        });

        // Fermer le modal si on clique en dehors
        document.getElementById('vapi-demo-modal').addEventListener('click', (e) => {
            if (e.target.id === 'vapi-demo-modal') {
                document.getElementById('vapi-close-modal').click();
            }
        });
    </script>
</body>
</html>
